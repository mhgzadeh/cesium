<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.92/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.92/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <title>Cesium Solar Panel</title>
</head>

<body>
    <style>
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>

    <div id="cesiumContainer"></div>
    <script>
        // Grant CesiumJS access to your ion assets
        Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxNDFmODI5Zi00ZDNhLTRkMDItYWY4Mi01MWY5MDgwMDE2ZWYiLCJpZCI6ODcyMTYsImlhdCI6MTY0ODQwMzYxOX0.r0ebixHbBDQ8CCW0jx915yrL6J5cvJWyoMLvhYWfDo0";

        // const viewer = new Cesium.Viewer("cesiumContainer", {
        //     terrainProvider: new Cesium.CesiumTerrainProvider({
        //         url: Cesium.IonResource.fromAssetId(1),
        //     }),
        // });
        // viewer.scene.globe.depthTestAgainstTerrain = true;

        // const tileset = viewer.scene.primitives.add(
        //     new Cesium.Cesium3DTileset({
        //         url: Cesium.IonResource.fromAssetId(969632),
        //     })
        // );
        // viewer.zoomTo(tileset);

        // ###############################################################

        const viewer = new Cesium.Viewer("cesiumContainer");

        function createModel(url, x, y, height) {
            const position = Cesium.Cartesian3.fromDegrees(x, y, height);
            viewer.entities.add({
                name: url,
                position: position,
                model: {
                    uri: url,
                },
            });
        }

        const numberOfBalloons = 13;
        const lonIncrement = 0.00025;
        const initialLon = -122.99875;
        const lat = 44.0503706;
        const height = 100.0;

        const url = "../SampleData/models/CesiumBalloon/CesiumBalloon.glb";

        for (let i = 0; i < numberOfBalloons; ++i) {
            const lon = initialLon + i * lonIncrement;
            createModel(url, lon, lat, height);
        }

        const viewModel = {
            show: true,
            glowOnly: false,
            contrast: 128,
            brightness: -0.3,
            delta: 1.0,
            sigma: 3.78,
            stepSize: 5.0,
        };

        Cesium.knockout.track(viewModel);
        const toolbar = document.getElementById("toolbar");
        Cesium.knockout.applyBindings(viewModel, toolbar);
        for (const name in viewModel) {
            if (viewModel.hasOwnProperty(name)) {
                Cesium.knockout
                    .getObservable(viewModel, name)
                    .subscribe(updatePostProcess);
            }
        }

        function updatePostProcess() {
            const bloom = viewer.scene.postProcessStages.bloom;
            bloom.enabled = Boolean(viewModel.show);
            bloom.uniforms.glowOnly = Boolean(viewModel.glowOnly);
            bloom.uniforms.contrast = Number(viewModel.contrast);
            bloom.uniforms.brightness = Number(viewModel.brightness);
            bloom.uniforms.delta = Number(viewModel.delta);
            bloom.uniforms.sigma = Number(viewModel.sigma);
            bloom.uniforms.stepSize = Number(viewModel.stepSize);
        }
        updatePostProcess();

        const target = Cesium.Cartesian3.fromDegrees(
            initialLon + lonIncrement,
            lat,
            height + 7.5
        );
        const offset = new Cesium.Cartesian3(
            -37.048378684557974,
            -24.852967044804245,
            4.352023653686047
        );
        viewer.scene.camera.lookAt(target, offset);
    </script>
</body>

</html>